description: >
  This orb can be used to generate a Container Profile ("X-Ray") and aggregated Vulnerability Report for a given container build using the Slim Developer Platform. The generated reports will be uploaded to CircleCI's Artifacts tab as JSON documents, and the container image will also be added to the user's "Favorites" collection in the Slim portal for easy access in the future.

usage:
  version: 2.1
  orbs:
    slim-scanner: slimdevops/slim-scanner@0.0.1
  parameters:
    image-name:
      description: Container image to be scanned
      type: string
      default: library/node:latest #Name of the image to be scanned eg:node
    image-connector:
      description: Registry Connector name from Slim platform (e.g., `dockerhub.public`)
      type: string
      default: dockerhub.public #Connector used by slim to get the image eg:dockerhub.public
    cimg-tag:
      description: Image tag to be used for the CircleCI base image (e.g., cimg/base).
      type: string
      default: current #Which tag to be used for cimg eg:  cimg/base:current
  jobs:
    build:
      docker:
        - image: cimg/base:<< pipeline.parameters.cimg-tag >>
      steps:
        - checkout
        - slim-scanner/xray:
            imageName: << pipeline.parameters.image-name >>
            imageConnector: << pipeline.parameters.image-connector >>
            cimgTag: << pipeline.parameters.cimg-tag >>
        - store_artifacts:
            path: /tmp/artifact-xray
            destination: "Filename for artifact"
        - slim-scanner/vscan:
            imageName: << pipeline.parameters.image-name >>
            imageConnector: << pipeline.parameters.image-connector >>
            cimgTag: << pipeline.parameters.cimg-tag >>
        - store_artifacts:
            path: /tmp/artifact-vscan
            destination: "Filename for artifact"
  workflows:
    use-my-orb:
      jobs:
        - build
