description: >
  Generate an aggregated Vulnerability Report for a given container build using the Slim Developer Platform. The generated report will be uploaded to CircleCI's Artifacts tab as a JSON document.
# Provide a use-case based example for using this orb.
# Everything in the `usage` section will be displayed in the orb registry.
# Comments are not retained.
usage:
  version: 2.1
  orbs:
    slim-scanner: slimdevops/slim-scanner@0.0.1
  parameters:
    image-name:
      description: Container image to be scanned
      type: string
    image-connector:
      description: Registry Connector name from Slim platform (i.e., `dockerhub.public`)
      type: string
      default: dockerhub.public #Connector used by slim to get the image eg:dockerhub.public
    cimg-tag:
      description: Image tag to be used for the CircleCI base image (i.e., cimg/base).
      type: string
      default: current #Which tag to be used for cimg eg:  cimg/base:current
  jobs:
    build:
      docker:
        - image: cimg/base:<< pipeline.parameters.cimg-tag >>
      steps:
        - checkout
        - slim-scanner/vscan:
            imageName: << pipeline.parameters.image-name >>
            imageConnector: << pipeline.parameters.image-connector >>
            cimgTag: << pipeline.parameters.cimg-tag >>
        - store_artifacts:
            path: /tmp/artifact-vscan
            destination: "Filename for artifact"
  workflows:
    use-my-orb:
      jobs:
        - build
